<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—¨ç¦ç”µæ¢¯å¡ä¿®æ”¹å¸¸ç”¨äººå‘˜</title>
    <link rel="icon" href="../favicon.ico">
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="keywords" content="é—¨ç¦,ç”µæ¢¯å¡,ä¿®æ”¹,å¸¸ç”¨äººå‘˜,é—¨ç¦ç”µæ¢¯å¡ä¿®æ”¹å¸¸ç”¨äººå‘˜,é—¨ç¦ç”µæ¢¯å¡,ä¿®æ”¹å¸¸ç”¨äººå‘˜,æŸ¥è¯¢">
    <meta name="description" content="é—¨ç¦ç”µæ¢¯å¡ä¿®æ”¹å¸¸ç”¨äººå‘˜æŸ¥è¯¢é¡µé¢ï¼Œåœ¨è¿™é‡Œæ‚¨å¯ä»¥æŸ¥è¯¢åˆ°ä¼—å¤šåˆ¶å¡äººçš„è”ç³»æ–¹å¼ï¼Œä»¥ä¾¿è”ç³»ã€å’¨è¯¢ã€‚">
    <meta name="robots" content="all">
    <!-- å¤‡ç”¨æç¤ºç»„ä»¶ï¼ˆé˜²æ­¢lu2åŠ è½½å¤±è´¥ï¼‰ -->
    <script>
        // è½»é‡çº§æç¤ºç»„ä»¶å¤‡ç”¨å®ç°
        window.LightTip = window.LightTip || class {
            constructor(message, type = 'info') {
                this.createTip(message, type);
            }
            createTip(message, type) {
                const tip = document.createElement('div');
                const bgColor = type === 'success' ? '#52c41a' : type === 'error' ? '#f5222d' : '#1890ff';
                tip.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${bgColor};
                    color: white;
                    padding: 8px 16px;
                    border-radius: 4px;
                    z-index: 9999;
                    animation: fadeInUp 0.3s, fadeOut 0.3s 2.7s;
                `;
                tip.textContent = message;
                document.body.appendChild(tip);
                setTimeout(() => tip.remove(), 3000);
                
                // æ·»åŠ åŠ¨ç”»æ ·å¼
                if (!document.querySelector('#tipStyles')) {
                    const style = document.createElement('style');
                    style.id = 'tipStyles';
                    style.textContent = `
                        @keyframes fadeInUp {
                            from { opacity: 0; transform: translate(-50%, -20px); }
                            to { opacity: 1; transform: translate(-50%, 0); }
                        }
                        @keyframes fadeOut {
                            from { opacity: 1; }
                            to { opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
        };
    </script>
    <script type="module" src="https://unpkg.com/lu2/theme/edge/js/common/ui/LightTip.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/lu2/theme/edge/css/common/ui/LightTip.css">
    <link rel="stylesheet" href="https://unpkg.com/lu2/theme/edge/css/common/ui/Tips.css">
    <script type="module" src="https://unpkg.com/lu2/theme/edge/js/common/ui/Tips.js"></script>
    <!-- é…ç½® Tailwind è‡ªå®šä¹‰ä¸»é¢˜ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#4080FF',
                        accent: '#0FC6C2',
                        neutral: '#F5F7FA',
                        dark: '#1D2129',
                        danger: '#F53F3F',
                        like: '#FF4D4F',
                        dislike: '#722ED1',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 20px rgba(0, 0, 0, 0.08)',
                        'hover': '0 8px 30px rgba(22, 93, 255, 0.15)',
                    }
                },
            }
        }
    </script>
    <style>
        .head_img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            object-fit: cover;
        }

        .table-scroll-container {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        th {
            white-space: nowrap;
        }

        .vote-btn {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .vote-btn:hover {
            transform: scale(1.1);
        }

        .vote-btn.liked {
            color: #FF4D4F;
            font-weight: bold;
        }

        .vote-btn.disliked {
            color: #722ED1;
            font-weight: bold;
        }

        .vote-count {
            font-size: 0.9rem;
            margin-left: 4px;
        }

        .vote-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .table-scroll-container::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .table-scroll-container::-webkit-scrollbar-thumb {
            background-color: #ddd;
            border-radius: 3px;
        }
        .table-scroll-container::-webkit-scrollbar-thumb:hover {
            background-color: #bbb;
        }
    </style>
</head>
<body class="font-inter bg-neutral min-h-screen text-dark">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-sm sticky top-0 z-50 transition-all duration-300" id="header">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="text-primary text-2xl flex items-center">
                    <img src="../favicon.ico" alt="logoå›¾æ ‡" class="w-10 h-10 object-contain">
                </div>
                <a href="./" rel="noopener noreferrer" aria-label="è¿”å›é¦–é¡µ">
                    <h1 class="text-[clamp(1.2rem,3vw,1.8rem)] font-bold text-primary">é—¨ç¦ç”µæ¢¯å¡ä¿®æ”¹å¸¸ç”¨äººå‘˜</h1>
                </a>
            </div>
            <div class="text-sm text-gray-500 hidden md:block">
                <span id="lastUpdate">æ•°æ®åŠ è½½ä¸­...</span>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8">
        <!-- æœç´¢åŒºåŸŸ -->
        <div class="mb-8 bg-white rounded-xl shadow-card p-6 transition-all duration-300 hover:shadow-hover">
            <div class="relative">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="è¾“å…¥å…³é”®è¯æœç´¢ï¼ˆå¦‚ï¼šæ— èŠçŠ¬ï¼‰" 
                    class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all duration-300 text-lg"
                    aria-label="æœç´¢äººå‘˜å…³é”®è¯"
                >
                <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">ğŸ”</div>
                <button 
                    id="clearSearch" 
                    class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden"
                    aria-label="æ¸…é™¤æœç´¢å†…å®¹"
                >
                    Ã—
                </button>
            </div>
            <div class="mt-4 flex flex-wrap gap-2">
                <span class="text-sm text-gray-500">â„¹ï¸ æ”¯æŒæ¨¡ç³Šæœç´¢ï¼ŒåŒ¹é…ç³»ç»ŸååŒ…å«å…³é”®è¯çš„ç»“æœ</span>
                <span class="text-sm text-gray-500">âš ï¸ æ’åä¸åˆ†å‰åï¼éšæœºæ’åï¼</span>
            </div>
        </div>

        <!-- è¡¨æ ¼åŒºåŸŸ -->
        <div class="bg-white rounded-xl shadow-card overflow-hidden transition-all duration-300 hover:shadow-hover">
            <div class="table-scroll-container">
                <table class="w-full min-w-[868px]">
                    <thead>
                        <tr class="bg-primary text-white sticky top-0 z-30">
                            <th class="py-4 px-6 text-left text-lg font-semibold">å¤´åƒ</th>
                            <th class="py-4 px-6 text-center text-lg font-semibold">æ˜µç§°</th>
                            <th class="py-4 px-6 text-center text-lg font-semibold">QQ</th>
                            <th class="py-4 px-6 text-center text-lg font-semibold">æè¿°</th>
                        </tr>
                    </thead>
                    <tbody id="systemTableBody" class="divide-y divide-gray-100">
                        <tr>
                            <td colspan="4" class="py-16 text-center text-gray-500">
                                <div class="animate-spin text-2xl mb-4 block">âŸ³</div>
                                <p>æ•°æ®åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="noResult" class="py-16 text-center text-gray-500 hidden">
                <div class="text-3xl mb-4 block text-gray-300">ğŸ”</div>
                <p>æœªæ‰¾åˆ°åŒ¹é…çš„äººç‰©ï¼Œè¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯</p>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-white mt-12 py-6 border-t border-gray-100">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>éº¦ç”°åŠ©æ‰‹ç³»ç»Ÿæ”¯æŒæŸ¥è¯¢ | ä»…ä¸ºæ–¹ä¾¿å¡åŒ ä½¿ç”¨ï¼Œç¦æ­¢ç”¨äºè¿æ³•ç”¨é€” | Ver:1.20</p>
        </div>
    </footer>

    <!-- æ›´æ–°æç¤ºå¼¹çª— -->
    <div id="updateModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" aria-hidden="true">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="modalContent">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 text-primary mb-4">
                    <div class="text-2xl">âŸ³</div>
                </div>
                <h3 class="text-xl font-bold text-dark mb-2">æ•°æ®æ›´æ–°æç¤º</h3>
                <p class="text-gray-500">å·²æœ‰1å°æ—¶æœªæ›´æ–°æ•°æ®ï¼Œæ˜¯å¦åˆ·æ–°è·å–æœ€æ–°ä¿¡æ¯ï¼Ÿ</p>
            </div>
            <div class="flex space-x-4">
                <button id="cancelUpdate" class="flex-1 py-3 px-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50 transition-all duration-300">
                    ç¨åæ›´æ–°
                </button>
                <button id="confirmUpdate" class="flex-1 py-3 px-4 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all duration-300">
                    ç«‹å³æ›´æ–°
                </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        const systemData = {};
        let searchKeyword = '';
        const voteData = {}; // å­˜å‚¨æŠ•ç¥¨æ•°æ® { qq: { likes: 0, dislikes: 0, user_status: '' } }

        // DOMå…ƒç´ 
        const elements = {
            searchInput: document.getElementById('searchInput'),
            clearSearch: document.getElementById('clearSearch'),
            tableBody: document.getElementById('systemTableBody'),
            noResult: document.getElementById('noResult'),
            lastUpdate: document.getElementById('lastUpdate'),
            updateModal: document.getElementById('updateModal'),
            modalContent: document.getElementById('modalContent'),
            confirmUpdate: document.getElementById('confirmUpdate'),
            cancelUpdate: document.getElementById('cancelUpdate'),
            header: document.getElementById('header')
        };

        // é˜²æŠ–å‡½æ•°
        const debounce = (func, delay = 300) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        };

        // é¡µé¢æ»šåŠ¨æ•ˆæœ
        window.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                elements.header.classList.add('py-2', 'shadow');
                elements.header.classList.remove('py-4', 'shadow-sm');
            } else {
                elements.header.classList.add('py-4', 'shadow-sm');
                elements.header.classList.remove('py-2', 'shadow');
            }
        });

        // æ ¼å¼åŒ–æ—¶é—´
        const formatTime = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hour = String(date.getHours()).padStart(2, '0');
            const minute = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hour}:${minute}`;
        };

        // è¯·æ±‚æ•°æ®
        const fetchSystemData = async () => {
            try {
                elements.tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="py-16 text-center text-gray-500">
                            <div class="animate-spin text-2xl mb-4 block">âŸ³</div>
                            <p>æ•°æ®åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</p>
                        </td>
                    </tr>
                `;

                // åŠ è½½äººå‘˜æ•°æ®
                const peopleResponse = await fetch('./people.json');
                if (!peopleResponse.ok) throw new Error('äººå‘˜æ•°æ®åŠ è½½å¤±è´¥ï¼ŒHTTPçŠ¶æ€ï¼š' + peopleResponse.status);

                const peopleData = await peopleResponse.json();
                Object.assign(systemData, peopleData.people || {});

                const now = new Date();
                elements.lastUpdate.textContent = `æœ€åæ›´æ–°ï¼š${formatTime(now)}`;

                renderTable();

            } catch (error) {
                elements.tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="py-16 text-center text-red-500">
                            <div class="text-2xl mb-4 block">âŒ</div>
                            <p>${error.message}</p>
                            <button onclick="fetchSystemData()" class="mt-4 text-primary hover:underline">é‡è¯•</button>
                        </td>
                    </tr>
                `;
                console.error('æ•°æ®åŠ è½½é”™è¯¯:', error);
                new LightTip('æ•°æ®åŠ è½½å¤±è´¥ï¼', 'error');
            }
        };

        // Fisher-Yates æ´—ç‰Œç®—æ³• - éšæœºæ’åºæ•°ç»„
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // æ¸²æŸ“è¡¨æ ¼
        const renderTable = () => {
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶éšæœºæ’åº
            let systems = Object.entries(systemData);
            systems = shuffleArray(systems);

            // æœç´¢ç­›é€‰
            if (searchKeyword.trim()) {
                const keyword = searchKeyword.trim().toLowerCase();
                systems = systems.filter(([name, config]) => 
                    name.toLowerCase().includes(keyword) ||
                    (config.user_note && config.user_note.toLowerCase().includes(keyword)) ||
                    (config.user_name && config.user_name.toLowerCase().includes(keyword)) ||
                    (config.user_qq && config.user_qq.toString().includes(keyword))
                );
            }

            // æ— ç»“æœå¤„ç†
            if (systems.length === 0) {
                elements.tableBody.innerHTML = '';
                elements.noResult.classList.remove('hidden');
                return;
            }

            elements.noResult.classList.add('hidden');

            // æ„å»ºè¡¨æ ¼å†…å®¹
            let tableHtml = '';
            systems.forEach(([name, config], index) => {
                const userQq = config.user_qq || '';
                const votes = voteData[userQq] || { likes: 0, dislikes: 0, user_status: '' };
                const userStatus = votes.user_status || '';

                tableHtml += `
                    <tr class="hover:bg-neutral/50 transition-all duration-300" style="animation: fadeInUp 0.3s ease ${index * 50}ms both">
                        <td class="py-4 px-6 font-medium text-lg">
                            <img 
                                src="${config.user_qq_head_url || '../favicon.ico'}" 
                                alt="${config.user_name || 'ç”¨æˆ·å¤´åƒ'}"
                                class="head_img"
                                onerror="this.src='../favicon.ico'"
                            >
                        </td>
                        <td class="py-4 px-6 text-center">${config.user_name || 'æœªå‘½å'}</td>
                        <td class="py-4 px-6 text-center">
                            <button 
                                onclick="copyText('${userQq}')" 
                                class="text-primary hover:underline"
                                aria-label="å¤åˆ¶QQå·: ${userQq}"
                            >
                                ${userQq}
                            </button>
                        </td>
                        <td class="py-4 px-6 text-center">${config.user_note || 'æ— æè¿°'}</td>
                    </tr>
                `;
            });

            elements.tableBody.innerHTML = tableHtml;
        };

        // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
        const copyText = async (text) => {
            try {
                if (!text) {
                    new LightTip('æ— å†…å®¹å¯å¤åˆ¶ï¼', 'error');
                    return;
                }

                if (navigator.clipboard) {
                    await navigator.clipboard.writeText(text);
                } else {
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.opacity = "0";
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textArea);
                }

                new LightTip('QQå·å·²å¤åˆ¶ï¼', 'success');
            } catch (err) {
                new LightTip('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼', 'error');
                console.error('å¤åˆ¶å¤±è´¥:', err);
            }
        };
        window.copyText = copyText; // æš´éœ²åˆ°å…¨å±€

        // æœç´¢åŠŸèƒ½ï¼ˆé˜²æŠ–å¤„ç†ï¼‰
        elements.searchInput.addEventListener('input', debounce((e) => {
            searchKeyword = e.target.value;
            renderTable();
            elements.clearSearch.classList.toggle('hidden', !searchKeyword.trim());
        }));

        // æ¸…é™¤æœç´¢
        elements.clearSearch.addEventListener('click', () => {
            elements.searchInput.value = '';
            searchKeyword = '';
            elements.clearSearch.classList.add('hidden');
            renderTable();
            elements.searchInput.focus();
        });

        // å¼¹çª—æ§åˆ¶
        const showUpdateModal = () => {
            elements.updateModal.classList.remove('hidden');
            elements.updateModal.setAttribute('aria-hidden', 'false');
            setTimeout(() => {
                elements.modalContent.classList.remove('scale-95', 'opacity-0');
                elements.modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        };

        const hideUpdateModal = () => {
            elements.modalContent.classList.remove('scale-100', 'opacity-100');
            elements.modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                elements.updateModal.classList.add('hidden');
                elements.updateModal.setAttribute('aria-hidden', 'true');
            }, 300);
        };

        // ç¡®è®¤æ›´æ–°
        elements.confirmUpdate.addEventListener('click', () => {
            hideUpdateModal();
            fetchSystemData();
        });

        // å–æ¶ˆæ›´æ–°
        elements.cancelUpdate.addEventListener('click', hideUpdateModal);

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        elements.updateModal.addEventListener('click', (e) => {
            if (e.target === elements.updateModal) hideUpdateModal();
        });

        // ESCå…³é—­å¼¹çª—
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !elements.updateModal.classList.contains('hidden')) {
                hideUpdateModal();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            fetchSystemData();
            elements.searchInput.focus();

            // æ¯å°æ—¶æç¤ºæ›´æ–°
            setInterval(showUpdateModal, 3600000);

            // æ·»åŠ CSSåŠ¨ç”»
            if (!document.querySelector('#tableAnimations')) {
                const style = document.createElement('style');
                style.id = 'tableAnimations';
                style.textContent = `
                    @keyframes fadeInUp {
                        from { opacity: 0; transform: translateY(20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                `;
                document.head.appendChild(style);
            }
        });

        // æ§åˆ¶å°ä¿¡æ¯
        console.log('%cFuck WuLiaoge', 'background: red; color: black;');
    </script>
    <script src="../fuck_wldog.js"></script>
</body>
</html>